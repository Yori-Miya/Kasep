<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KASEP</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="font-sans text-gray-800">
    <!-- ===== HERO ===== -->
    <section
      class="relative min-h-screen bg-cover bg-center bg-no-repeat flex items-center justify-center px-6"
      style="background-image: url('./assets/image/background.png')"
    >
      <!-- Konten -->
      <div class="relative z-10 text-center w-full bg-opacity-90 p-8">
        <div class="flex items-center justify-center gap-4">
          <h2 class="text-xl md:text-3xl font-bold text-gray-800">SELAMAT DATANG DI</h2>
          <img
            src="./assets/image/logo-text.png"
            alt="KASEP Logo"
            class="w-20 md:w-24"
          />
        </div>

        <img
          src="./assets/image/profile.png"
          alt=""
          class="w-24 mx-auto my-4"
        />

        <!-- Form Login -->
<form action=".html" method="post" class="space-y-4 max-w-md mx-auto">
  <button
    id="google-login-btn"
    type="button"
    class="w-full px-4 py-2 border font-bold flex items-center justify-center gap-2 rounded-md bg-white"
  >
    <img src="./assets/image/google.png" alt="" width="20" />
    Masuk dengan Google
  </button>

  <div class="flex items-center justify-center gap-4 my-6">
    <hr class="flex-grow border-t border-gray-700" />
    <span class="text-gray-800 font-medium">Atau</span>
    <hr class="flex-grow border-t border-gray-700" />
  </div>

  <input
    type="text"
    id="username"
    name="username"
    class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500"
    placeholder="Email"
    required
  />

  <div class="relative mt-4">
    <input
      id="password"
      type="password"
      placeholder="Masukkan password"
      class="w-full px-4 py-3 rounded-xl shadow text-sm focus:outline-none pr-10"
      required
    />
    <img
      id="togglePassword1"
      src="./assets/image/tutup.png"
      alt="Toggle"
      class="w-5 h-5 absolute top-1/2 right-3 -translate-y-1/2 cursor-pointer"
    />
  </div>

  <button
    type="submit"
    class="w-full bg-cyan-500 text-white font-semibold py-2 rounded-md hover:bg-cyan-600 transition"
  >
    Masuk
  </button>
  <span class="text-sm"><a href="register.html" class="text-cyan-500">Buat Akun</a> atau <a href="reset-password.html" class="text-cyan-500">Reset Password</span>
</form>
      </div>
    </section>

    <script>
      function setupToggle(toggleId, inputId) {
        const toggle = document.getElementById(toggleId);
        const input = document.getElementById(inputId);

        toggle.addEventListener("click", () => {
          const isPassword = input.type === "password";
          input.type = isPassword ? "text" : "password";
          toggle.src = isPassword
            ? "./assets/image/buka.png"
            : "./assets/image/tutup.png";
        });
      }

      // Setup untuk kedua input
      setupToggle("togglePassword1", "password");

      document.addEventListener("DOMContentLoaded", function () {
        // Fungsikan link reset password agar redirect dengan uid user terkait
        document.querySelectorAll('a[href="reset-password.html"]').forEach(link => {
          link.addEventListener('click', async function(e) {
            e.preventDefault();
            const email = document.getElementById('username').value.trim();
            if (!email) {
              alert("Silakan isi email terlebih dahulu.");
              return;
            }
            try {
              // Cari userId berdasarkan email di Firestore
              const userQuery = await firebase.firestore().collection('user').where('email', '==', email).limit(1).get();
              if (userQuery.empty) {
                alert("Email tidak ditemukan.");
                return;
              }
              const userId = userQuery.docs[0].id;
              window.location.href = `reset-password.html?uid=${userId}`;
            } catch (err) {
              alert("Terjadi kesalahan. Silakan coba lagi.");
            }
          });
        });
      });
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="config/firebase-config.js"></script>
    <script src="login/auth.js"></script>
  </body>
</html>
